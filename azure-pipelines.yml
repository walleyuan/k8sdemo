
variables:
  imageName: 'dockerctr.azurecr.io/k8s-demo'
  
steps:
  - task: Docker@2
    displayName: Build and Push an image
    inputs:
          repository: $(imageName)
          command: buildAndPush
          Dockerfile: app/Dockerfile
          tags: 1.0

  - task: PowerShell@2
    displayName: Terrafom Init
    inputs:
      targetType: 'inline'
      script: |
        # run terrafom 
        terraform init
      workingDirectory: '/infra/k8s-cluster'